# Security and Ops (MVP)

## 1) 인증/권한
- 기본 역할:
1. `user`: 본인 Skill/Provider/Run 관리
2. `admin`: 전체 조회 및 운영 조치
- 모든 수정 API는 인증 + 소유권/역할 체크 필수
- 게스트 계정은 운영 액션(설치/재시도/롤백) 금지

## 2) 시크릿 관리
- API key는 코드/DB 평문 저장 금지
- 저장 원칙:
1. 앱 DB에는 시크릿 참조키만 저장
2. 실제 값은 외부 시크릿 스토어 사용
- 로그/에러 응답에서 key/token 노출 금지

## 3) 입력 검증/보호
- 외부 입력은 모두 `zod`로 검증
- GitHub URL은 allow-list 규칙(도메인, 프로토콜) 적용
- 장문 입력은 길이 제한 및 sanitization 적용

## 4) 감사 로그
- 최소 필드:
1. 사용자 ID
2. 액션 타입
3. 대상(skill/provider/run)
4. 결과(성공/실패)
5. 시각
- 챗봇 액션은 원문 입력 + 해석된 액션 파라미터를 함께 저장

## 5) 운영 모니터링
- 대시보드 필수 지표:
1. 설치 성공률(24h)
2. 실패 건수
3. 평균 실행 시간
4. provider별 오류율
- 경보 조건:
1. 동일 provider 연속 실패 N회
2. 장시간 running 상태

## 6) 장애 대응
- 기본 대응 순서:
1. 실패 범위 확인(provider/skill/action)
2. 공통 오류 여부 확인(인증/네트워크)
3. 실패 대상만 재시도
4. 필요시 이전 버전 롤백
- 대시보드/챗봇에서 동일 대응 플로우를 제공

## 7) 배포/운영 체크리스트
- 배포 전:
1. `pnpm lint`
2. `pnpm build`
3. 핵심 API 테스트
- 배포 후:
1. provider 연결 상태 점검
2. 샘플 install run 검증
3. 실패 알림 동작 점검

## 8) 데이터 보존
- install run 로그 보존 기간(MVP): 90일
- 감사 로그 보존 기간(MVP): 180일
- 만료 데이터는 배치 정리(archive 또는 delete)

## 9) 규정 준수 기본
- 최소 권한 원칙
- 목적 외 데이터 수집 금지
- 사용자 요청 시 계정/데이터 비활성화 경로 제공

